<!-- User Create/Edit Modal -->
<div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userModalLabel">Thêm người dùng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="userForm">
                <input type="hidden" id="csrfToken" value="{{ csrf_token() }}">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="fullName" class="form-label">Họ và tên <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="fullName" name="full_name" required>
                                <div class="text-danger small" id="fullNameError"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                                <input type="email" class="form-control" id="email" name="email" required>
                                <div class="text-danger small" id="emailError"></div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="phoneNumber" class="form-label">Số điện thoại</label>
                                <input type="tel" class="form-control" id="phoneNumber" name="phone_number">
                                <div class="text-danger small" id="phoneNumberError"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="studentId" class="form-label">Mã sinh viên</label>
                                <input type="text" class="form-control" id="studentId" name="student_id">
                                <div class="text-danger small" id="studentIdError"></div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="role" class="form-label">Vai trò <span class="text-danger">*</span></label>
                                <select class="form-select" id="role" name="role_name" required>
                                    <option value="">Chọn vai trò</option>
                                    <option value="student">Sinh viên</option>
                                    <option value="staff">Nhân viên</option>
                                    <option value="management">Quản lý</option>
                                    {% if current_user and current_user.role == 'admin' %}
                                    <option value="admin">Quản trị viên</option>
                                    {% endif %}
                                </select>
                                <div class="text-danger small" id="roleError"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="isActive" class="form-label">Trạng thái</label>
                                <select class="form-select" id="isActive" name="is_active">
                                    <option value="true">Hoạt động</option>
                                    <option value="false">Không hoạt động</option>
                                </select>
                                <div class="text-danger small" id="isActiveError"></div>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="passwordSection">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="password" class="form-label">Mật khẩu <span class="text-danger">*</span></label>
                                <input type="password" class="form-control" id="password" name="password">
                                <div class="text-danger small" id="passwordError"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="confirmPassword" class="form-label">Xác nhận mật khẩu <span class="text-danger">*</span></label>
                                <input type="password" class="form-control" id="confirmPassword" name="confirm_password">
                                <div class="text-danger small" id="confirmPasswordError"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary" id="saveUserBtn">
                        <i class="fas fa-save"></i> Lưu
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- User Detail Modal -->
<div class="modal fade" id="userDetailModal" tabindex="-1" aria-labelledby="userDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userDetailModalLabel">Chi tiết người dùng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="userDetailContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<!-- User Detail Content Template -->
<script type="text/html" id="userDetailTemplate">
    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <strong>ID:</strong> 
                <span class="text-muted">{% raw %}{{user_id}}{% endraw %}</span>
            </div>
            <div class="mb-3">
                <strong>Họ và tên:</strong> 
                <span class="text-muted">{% raw %}{{full_name}}{% endraw %}</span>
            </div>
            <div class="mb-3">
                <strong>Email:</strong> 
                <span class="text-muted">{% raw %}{{email}}{% endraw %}</span>
            </div>
            <div class="mb-3">
                <strong>Số điện thoại:</strong> 
                <span class="text-muted">{% raw %}{{phone_number}}{% endraw %}</span>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <strong>Mã sinh viên:</strong> 
                <span class="text-muted">{% raw %}{{student_id}}{% endraw %}</span>
            </div>
            <div class="mb-3">
                <strong>Vai trò:</strong> 
                <span class="badge {% raw %}{{role_badge_class}}{% endraw %}">{% raw %}{{role_text}}{% endraw %}</span>
            </div>
            <div class="mb-3">
                <strong>Trạng thái:</strong> 
                <span class="badge {% raw %}{{status_badge_class}}{% endraw %}">{% raw %}{{status_text}}{% endraw %}</span>
            </div>
            <div class="mb-3">
                <strong>Ngày tạo:</strong> 
                <span class="text-muted">{% raw %}{{created_at}}{% endraw %}</span>
            </div>
        </div>
    </div>
</script>

<!-- Error Template -->
<script type="text/html" id="userDetailErrorTemplate">
    <div class="alert alert-danger" role="alert">
        <i class="fas fa-exclamation-triangle"></i> {% raw %}{{message}}{% endraw %}
    </div>
</script>

<!-- Loading Template -->
<script type="text/html" id="userDetailLoadingTemplate">
    <div class="text-center">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Đang tải...</span>
        </div>
    </div>
</script>
